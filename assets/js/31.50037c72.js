(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{512:function(t,e,_){t.exports=_.p+"assets/img/1010000-20190624180004690-176676_9cc6bc4a1b9340098.4b13131f.png"},513:function(t,e,_){t.exports=_.p+"assets/img/1010000-20190624180016266-174990_f040cc19ca6b4adab.b671fd42.png"},514:function(t,e,_){t.exports=_.p+"assets/img/1010000-20190624180029853-171066_ffe8d085cc994ac2b.72f4723a.png"},515:function(t,e,_){t.exports=_.p+"assets/img/1010000-20190624180042971-145120_0e4e3ad9acd24abeb.fd2c5305.png"},516:function(t,e,_){t.exports=_.p+"assets/img/1010000-20190624180052470-321989_8bd3cc07227a42c49.61b10200.png"},816:function(t,e,_){"use strict";_.r(e);var v=_(3),r=Object(v.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"一、概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、概述"}},[t._v("#")]),t._v(" 一、概述")]),t._v(" "),e("blockquote",[e("p",[t._v("Digest认证是为了修复"),e("a",{attrs:{href:"https://www.cnblogs.com/xiaoxiaotank/p/11009796.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("基本认证"),e("OutboundLink")],1),t._v("协议的严重缺陷而设计的，秉承“绝不通过明文在网络发送密码”的原则，通过“密码摘要”进行认证，大大提高了安全性。")])]),t._v(" "),e("p",[t._v("相对于基本认证，主要有如下改进：")]),t._v(" "),e("ul",[e("li",[t._v("绝不通过明文在网络上发送密码")]),t._v(" "),e("li",[t._v("可以有效防止恶意用户进行重放攻击")]),t._v(" "),e("li",[t._v("可以有选择的防止对报文内容的篡改")])]),t._v(" "),e("p",[t._v("需要注意的是，摘要认证除了能够保护密码之外，并不能保护其他内容，与HTTPS配合使用仍是一个良好的选择。以下是摘要认证的具体流程图：")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1010000/201906/1010000-20190624180004690-1766769930.png",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:_(512),alt:""}}),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("看到上面出现了那么多之前没见过的参数，是不是有点慌（或是兴奋）？别着急，这里先给出一个概览：")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/WWW-Authenticate",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("WWW-Authentication")]),e("OutboundLink")],1),t._v("：用来定义使用何种方式（Basic、Digest、Bearer等）去进行认证以获取受保护的资源")]),t._v(" "),e("li",[e("code",[t._v("realm")]),t._v("：表示Web服务器中受保护文档的安全域（比如公司财务信息域和公司员工信息域），用来指示需要哪个域的用户名和密码")]),t._v(" "),e("li",[e("code",[t._v("qop")]),t._v("：保护质量，包含"),e("code",[t._v("auth")]),t._v("（默认的）和"),e("code",[t._v("auth-int")]),t._v("（增加了报文完整性检测）两种策略，（可以为空，但是）不推荐为空值")]),t._v(" "),e("li",[e("code",[t._v("nonce")]),t._v("：服务端向客户端发送质询时附带的一个随机数，这个数会经常发生变化。客户端计算密码摘要时将其附加上去，使得多次生成同一用户的密码摘要各不相同，用来防止重放攻击")]),t._v(" "),e("li",[e("code",[t._v("nc")]),t._v("：nonce计数器，是一个16进制的数值，表示同一nonce下客户端发送出请求的数量。例如，在响应的第一个请求中，客户端将发送“nc=00000001”。这个指示值的目的是让服务器保持这个计数器的一个副本，以便检测重复的请求")]),t._v(" "),e("li",[e("code",[t._v("cnonce")]),t._v("：客户端随机数，这是一个不透明的字符串值，由客户端提供，并且客户端和服务器都会使用，以避免用明文文本。这使得双方都可以查验对方的身份，并对消息的完整性提供一些保护")]),t._v(" "),e("li",[e("code",[t._v("response")]),t._v("：这是由用户代理软件计算出的一个字符串，以证明用户知道口令")]),t._v(" "),e("li",[e("code",[t._v("Authorization-Info")]),t._v("：用于返回一些与授权会话相关的附加信息")]),t._v(" "),e("li",[e("code",[t._v("nextnonce")]),t._v("：下一个服务端随机数，使客户端可以预先发送正确的摘要")]),t._v(" "),e("li",[e("code",[t._v("rspauth")]),t._v("：响应摘要，用于客户端对服务端进行认证")]),t._v(" "),e("li",[e("code",[t._v("stale")]),t._v("：当密码摘要使用的随机数过期时，服务器可以返回一个附带有新随机数的401响应，并指定"),e("code",[t._v("stale=true")]),t._v("，表示服务器在告知客户端用新的随机数来重试，而不再要求用户重新输入用户名和密码了")])]),t._v(" "),e("h1",{attrs:{id:"二、剖析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、剖析"}},[t._v("#")]),t._v(" 二、剖析")]),t._v(" "),e("p",[t._v("1.当打开需要认证的页面时，会弹出一个对话框，要求用户输入用户名和密码")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1010000/201906/1010000-20190624180016266-1749901860.png",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:_(513),alt:""}}),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("2.使用Fidder监听请求，可以看到在未进行认证或认证失败的情况下，服务端会返回"),e("code",[t._v("401 Unauthorized")]),t._v("给客户端，并附带Challenge")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1010000/201906/1010000-20190624180029853-1710667127.png",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{width:"1000",height:"475",src:_(514)}}),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("3.输入正确的用户名和密码后，浏览器会生成密码摘要以及其他信息发送给服务端，服务端认证成功后，返回一些与授权会话相关的附加信息，放在"),e("code",[t._v("Authorization-Info")]),t._v("中。")]),t._v(" "),e("p",[t._v("其中，客户端选择的保护质量策略为"),e("code",[t._v("auth")]),t._v("，"),e("code",[t._v("response")]),t._v("就是通过计算得到的密码摘要，具体计算方式如下（使用默认的MD5加密算法）：MD5(MD5(A1):<nonce>:<nc>:<cnonce>:<qop>:MD5(A2))")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("算法")]),t._v(" "),e("th",[t._v("A1")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("MD5（默认）")]),t._v(" "),e("td",[t._v("<username>:<realm>:<password>")])]),t._v(" "),e("tr",[e("td",[t._v("MD5-sess")]),t._v(" "),e("td",[t._v("MD5(<username>:<realm>:<password>):<nonce>:<cnonce>")])])])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("qop")]),t._v(" "),e("th",[t._v("A2")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("auth（默认）")]),t._v(" "),e("td",[t._v("<request-method>:<uri>")])]),t._v(" "),e("tr",[e("td",[t._v("auth-int")]),t._v(" "),e("td",[t._v("<request-method>:<uri>:MD5(<request-entity-body>)")])])])]),t._v(" "),e("p",[t._v("另外，"),e("code",[t._v("rspauth")]),t._v("使得客户端可以对服务器进行认证，称为响应摘要。响应摘要的计算与请求摘要类似，但由于响应中没有方法，而且报文实体数据有所不同，所有只有报文主题信息A2不同。具体区别如下：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("qop")]),t._v(" "),e("th",[t._v("A2")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("auth（默认）")]),t._v(" "),e("td",[t._v(":<uri>")])]),t._v(" "),e("tr",[e("td",[t._v("auth-int")]),t._v(" "),e("td",[t._v(":<uri>:MD5(<response-entity-body>)")])])])]),t._v(" "),e("p",[e("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1010000/201906/1010000-20190624180042971-1451207131.png",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{width:"1000",height:"511",src:_(515)}}),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("4.当服务端随机数过期时，再次请求认证，可以看到质询中增加了"),e("code",[t._v("stale=true")]),t._v("，用户无需再次输入用户名和密码，浏览器会自动使用新的质询参数进行密码摘要的计算。")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://img2018.cnblogs.com/blog/1010000/201906/1010000-20190624180052470-321989792.png",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{width:"1000",height:"523",src:_(516)}}),e("OutboundLink")],1)]),t._v(" "),e("h1",{attrs:{id:"三、注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、注意事项"}},[t._v("#")]),t._v(" 三、注意事项")]),t._v(" "),e("p",[t._v("1.预授权：服务端预先告知客户端下一个随机数是多少，使得客户端可以直接生成正确的"),e("code",[t._v("Authorization")]),t._v("首部，避免了多次“请求/质询”。常用的有一下三种方式：")]),t._v(" "),e("ul",[e("li",[t._v("服务器预先在"),e("code",[t._v("Authorization-Info")]),t._v("成功首部中发送下一个随机数"),e("code",[t._v("nextnonce")]),t._v("。虽然这种机制加快了事务处理的速度，但是它也破坏了对同一台服务器的多次请求进行管道化的功能，可能会造成很大的损失。")]),t._v(" "),e("li",[t._v("服务器允许在一小段时间内使用同一个随机数。这也就是我们上面剖析中使用的机制，在一定时间内使用同一个随机数或限制某个随机数的重用次数，当过期时，声明"),e("code",[t._v("stale=true")]),t._v("。虽然这确实降低了安全性，但是重用的随机数的生存周期是可控的，应该在安全和性能之间找到平衡。")]),t._v(" "),e("li",[t._v("客户端和服务器使用同步的、可预测的随机数生成算法。")])]),t._v(" "),e("p",[t._v('2.RFC 2617建议采用这个假想的随机数公式：BASE64(timestamp MD5(timestamp ":" ETag ":" private-key))\n其中，'),e("code",[t._v("timestamp")]),t._v("是服务器产生随机数的时间或其他不重复的值，"),e("code",[t._v("ETag")]),t._v("是与所请求实体有关的HTTP ETag首部的值，"),e("code",[t._v("private-key")]),t._v("是只有服务器知道的私钥。")])])}),[],!1,null,null,null);e.default=r.exports}}]);