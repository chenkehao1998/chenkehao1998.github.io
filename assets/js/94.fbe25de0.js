(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{541:function(s,e,a){s.exports=a.p+"assets/img/1144139-20220128142648272-192645_107fe04c1b184a66b.1bb9ea6f.png"},873:function(s,e,a){"use strict";a.r(e);var n=a(3),r=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("blockquote",[e("p",[s._v("本文由原文地址 "),e("a",{attrs:{href:"https://www.cnblogs.com/minseo/p/11548177.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("www.cnblogs.com"),e("OutboundLink")],1)])]),s._v(" "),e("p",[s._v("参考："),e("a",{attrs:{href:"https://blog.51cto.com/9291927/2310444",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.51cto.com/9291927/2310444"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"一-docker-compose-简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-docker-compose-简介"}},[s._v("#")]),s._v(" 一. Docker-compose 简介")]),s._v(" "),e("h3",{attrs:{id:"_1-docker-compose-简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-compose-简介"}},[s._v("#")]),s._v(" 1. Docker-compose 简介")]),s._v(" "),e("p",[s._v("Docker-Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。 Docker-Compose 将所管理的容器分为三层，分别是工程（project），服务（service）以及容器（container）。Docker-Compose 运行目录下的所有文件（docker-compose.yml，extends 文件或环境变量文件等）组成一个工程，若无特殊指定工程名即为当前目录名。一个工程当中可包含多个服务，每个服务中定义了容器运行的镜像，参数，依赖。一个服务当中可包括多个容器实例，Docker-Compose 并没有解决负载均衡的问题，因此需要借助其它工具实现服务发现及负载均衡。 Docker-Compose 的工程配置文件默认为 docker-compose.yml，可通过环境变量 COMPOSE_FILE 或 - f 参数自定义配置文件，其定义了多个有依赖关系的服务及每个服务运行的容器。 使用一个 Dockerfile 模板文件，可以让用户很方便的定义一个单独的应用容器。在工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。 Compose 允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。 Docker-Compose 项目由 Python 编写，调用 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 Compose 来进行编排管理。")]),s._v(" "),e("h3",{attrs:{id:"_2-docker-compose-的安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker-compose-的安装"}},[s._v("#")]),s._v(" 2. Docker-compose 的安装")]),s._v(" "),e("p",[s._v("安装环境查看"),e("br"),s._v("\n也可以使用其他发行版本 Linux 系统"),e("br"),s._v(" "),e("img",{attrs:{src:a(541),alt:""}}),e("br"),s._v("\n安装"),e("br"),s._v(" "),e("code",[s._v("apt-get install python-pip")]),e("br"),s._v(" "),e("code",[s._v("apt-get -y install docker-compose")]),e("br"),s._v("\n红帽系 Linux 使用以下命令安装"),e("br"),s._v(" "),e("code",[s._v("yum -y install python-pip")]),e("br"),s._v(" "),e("code",[s._v("yum -y install docker-compose")]),e("br"),s._v("\n查看安装的版本"),e("br"),s._v(" "),e("code",[s._v("docker-compose -v")]),e("br"),s._v(" "),e("code",[s._v("docker-compose version 1.21.0, build unknown")])]),s._v(" "),e("h3",{attrs:{id:"_3-docker-compose-卸载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-docker-compose-卸载"}},[s._v("#")]),s._v(" 3. Docker-compose 卸载")]),s._v(" "),e("p",[e("code",[s._v("apt-get remove docker-compose")])]),s._v(" "),e("h2",{attrs:{id:"二-docker-compose-常用命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-docker-compose-常用命令"}},[s._v("#")]),s._v(" 二. Docker-compose 常用命令")]),s._v(" "),e("h3",{attrs:{id:"_1-docker-compose-命令格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-compose-命令格式"}},[s._v("#")]),s._v(" 1. Docker-compose 命令格式")]),s._v(" "),e("p",[e("code",[s._v("docker-compose [-f <arg>...] [options] [COMMAND] [ARGS...]")]),e("br"),s._v("\n命令选项如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("-f --file FILE指定Compose模板文件，默认为docker-compose.yml\n-p --project-name NAME 指定项目名称，默认使用当前所在目录为项目名\n--verbose  输出更多调试信息\n-v，-version 打印版本并退出\n--log-level LEVEL 定义日志等级(DEBUG, INFO, WARNING, ERROR, CRITICAL)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-docker-compose-up"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker-compose-up"}},[s._v("#")]),s._v(" 2. docker-compose up")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up [options] [--scale SERVICE=NUM...] [SERVICE...]\n选项包括：\n-d 在后台运行服务容器\n-no-color 不是有颜色来区分不同的服务的控制输出\n-no-deps 不启动服务所链接的容器\n--force-recreate 强制重新创建容器，不能与-no-recreate同时使用\n–no-recreate 如果容器已经存在，则不重新创建，不能与–force-recreate同时使用\n–no-build 不自动构建缺失的服务镜像\n–build 在启动容器前构建服务镜像\n–abort-on-container-exit 停止所有容器，如果任何一个容器被停止，不能与-d同时使用\n-t, –timeout TIMEOUT 停止容器时候的超时（默认为10秒）\n–remove-orphans 删除服务中没有在compose文件中定义的容器\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"_3-docker-compose-ps"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-docker-compose-ps"}},[s._v("#")]),s._v(" 3. docker-compose ps")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose  ps [options] [SERVICE...]\n列出项目中所有在运行的容器\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_4-docker-compose-stop"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-docker-compose-stop"}},[s._v("#")]),s._v(" 4. docker-compose stop")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose stop [options] [SERVICE...]\n选项包括\n-t, –timeout TIMEOUT 停止容器时候的超时（默认为10秒）\ndocker-compose stop\n停止正在运行的容器，可以通过docker-compose start 再次启动\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_5-docker-compose-h"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-docker-compose-h"}},[s._v("#")]),s._v(" 5. docker-compose -h")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose -h\n查看帮助\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_6-docker-compose-down"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-docker-compose-down"}},[s._v("#")]),s._v(" 6. docker-compose down")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose down [options]\n停止和删除容器、网络、卷、镜像。\n选项包括：\n–rmi type，删除镜像，类型必须是：all，删除compose文件中定义的所有镜像；local，删除镜像名为空的镜像\n-v, –volumes，删除已经在compose文件中定义的和匿名的附在容器上的数据卷\n–remove-orphans，删除服务中没有在compose中定义的容器\ndocker-compose down\n停用移除所有容器以及网络相关\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"_7-docker-compose-logs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-docker-compose-logs"}},[s._v("#")]),s._v(" 7. docker-compose logs")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose logs [options] [SERVICE...]\n查看服务容器的输出。默认情况下，docker-compose将对不同的服务输出使用不同的颜色来区分。可以通过–no-color来关闭颜色。\ndocker-compose logs\n查看服务容器的输出 \n-f 跟踪日志输出\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_8-docker-compose-bulid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-docker-compose-bulid"}},[s._v("#")]),s._v(" 8. docker-compose bulid")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose build [options] [--build-arg key=val...] [SERVICE...]\n构建（重新构建）项目中的服务容器。\n选项包括：\n–compress 通过gzip压缩构建上下环境\n–force-rm 删除构建过程中的临时容器\n–no-cache 构建镜像过程中不使用缓存\n–pull 始终尝试通过拉取操作来获取更新版本的镜像\n-m, –memory MEM为构建的容器设置内存大小\n–build-arg key=val为服务设置build-time变量\n服务容器一旦构建后，将会带上一个标记名。可以随时在项目目录下运行docker-compose build来重新构建服务\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h3",{attrs:{id:"_9-docker-compose-pull"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-docker-compose-pull"}},[s._v("#")]),s._v(" 9. docker-compose pull")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose pull [options] [SERVICE...]\n拉取服务依赖的镜像。\n选项包括：\n–ignore-pull-failures，忽略拉取镜像过程中的错误\n–parallel，多个镜像同时拉取\n–quiet，拉取镜像过程中不打印进度信息\ndocker-compose pull\n拉取服务依赖的镜像\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"_10-docker-compose-restart"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-docker-compose-restart"}},[s._v("#")]),s._v(" 10. docker-compose restart")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose restart [options] [SERVICE...]\n重启项目中的服务。\n选项包括：\n-t, –timeout TIMEOUT，指定重启前停止容器的超时（默认为10秒）\ndocker-compose restart\n重启项目中的服务 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"_11-docker-compose-rm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-docker-compose-rm"}},[s._v("#")]),s._v(" 11. docker-compose rm")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose rm [options] [SERVICE...]\n删除所有（停止状态的）服务容器。\n选项包括：\n–f, –force，强制直接删除，包括非停止状态的容器\n-v，删除容器所挂载的数据卷\ndocker-compose rm\n删除所有（停止状态的）服务容器。推荐先执行docker-compose stop命令来停止容器。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_12-docker-compose-start"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_12-docker-compose-start"}},[s._v("#")]),s._v(" 12. docker-compose start")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose start [SERVICE...]\ndocker-compose start\n启动已经存在的服务容器。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_13-docker-compose-run"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_13-docker-compose-run"}},[s._v("#")]),s._v(" 13. docker-compose run")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose scale web=3 db=2\n设置指定服务运行的容器个数。通过service=num的参数来设置数量\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_14-docker-compose-scale"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_14-docker-compose-scale"}},[s._v("#")]),s._v(" 14. docker-compose scale")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose scale web=3 db=2\n设置指定服务运行的容器个数。通过service=num的参数来设置数量\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_15-docker-compose-pause"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_15-docker-compose-pause"}},[s._v("#")]),s._v(" 15. docker-compose pause")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose pause [SERVICE...]\n暂停一个服务容器\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_16-docker-compose-kill"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_16-docker-compose-kill"}},[s._v("#")]),s._v(" 16. docker-compose kill")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose kill [options] [SERVICE...]\n通过发送SIGKILL信号来强制停止服务容器。 \n支持通过-s参数来指定发送的信号，例如通过如下指令发送SIGINT信号：\ndocker-compose kill -s SIGINT\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_17-docker-compose-config"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_17-docker-compose-config"}},[s._v("#")]),s._v(" 17. docker-compose config")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose config [options]\n验证并查看compose文件配置。\n选项包括：\n–resolve-image-digests 将镜像标签标记为摘要\n-q, –quiet 只验证配置，不输出。 当配置正确时，不输出任何内容，当文件配置错误，输出错误信息\n–services 打印服务名，一行一个\n–volumes 打印数据卷名，一行一个\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_18-docker-compose-create"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_18-docker-compose-create"}},[s._v("#")]),s._v(" 18. docker-compose create")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose create [options] [SERVICE...]\n为服务创建容器。\n选项包括：\n–force-recreate：重新创建容器，即使配置和镜像没有改变，不兼容–no-recreate参数\n–no-recreate：如果容器已经存在，不需要重新创建，不兼容–force-recreate参数\n–no-build：不创建镜像，即使缺失\n–build：创建容器前　　，生成镜像\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_19-docker-compose-exec"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_19-docker-compose-exec"}},[s._v("#")]),s._v(" 19. docker-compose exec")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose exec [options] SERVICE COMMAND [ARGS...]\n选项包括：\n-d 分离模式，后台运行命令。\n–privileged 获取特权。\n–user USER 指定运行的用户。\n-T 禁用分配TTY，默认docker-compose exec分配TTY。\n–index=index，当一个服务拥有多个容器时，可通过该参数登陆到该服务下的任何服务，例如：docker-compose exec –index=1 web /bin/bash ，web服务中包含多个容器\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"_20-docker-compose-port"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_20-docker-compose-port"}},[s._v("#")]),s._v(" 20. docker-compose port")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose port [options] SERVICE PRIVATE_PORT\n显示某个容器端口所映射的公共端口。\n选项包括：\n–protocol=proto，指定端口协议，TCP（默认值）或者UDP\n–index=index，如果同意服务存在多个容器，指定命令对象容器的序号（默认为1）\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_21-docker-compose-push"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_21-docker-compose-push"}},[s._v("#")]),s._v(" 21. docker-compose push")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose push [options] [SERVICE...]\n推送服务依的镜像。\n选项包括：\n–ignore-push-failures 忽略推送镜像过程中的错误\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_22-docker-compose-stop"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_22-docker-compose-stop"}},[s._v("#")]),s._v(" 22. docker-compose stop")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose stop [options] [SERVICE...]\n停止运行的容器\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_23-docker-compose-uppause"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_23-docker-compose-uppause"}},[s._v("#")]),s._v(" 23. docker-compose uppause")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose unpause [SERVICE...]\n恢复处于暂停状态中的服务。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"三-docker-compose-模板文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-docker-compose-模板文件"}},[s._v("#")]),s._v(" 三. Docker-compose 模板文件")]),s._v(" "),e("h3",{attrs:{id:"_1-docker-compose-模板文件简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-compose-模板文件简介"}},[s._v("#")]),s._v(" 1. Docker-compose 模板文件简介")]),s._v(" "),e("p",[s._v("Compose 允许用户通过一个 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。 Compose 模板文件是一个定义服务、网络和卷的 YAML 文件。Compose 模板文件默认路径是当前目录下的 docker-compose.yml，可以使用. yml 或. yaml 作为文件扩展名。"),e("br"),s._v("\nDocker-Compose 标准模板文件应该包含 version、services、networks 三大部分，最关键的是 services 和 networks 两个部分。"),e("br"),s._v("\n举例")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '3'\nservices:\n  web:\n    image: dockercloud/hello-world\n    ports:\n      - 8080\n    networks:\n      - front-tier\n      - back-tier\n\n  redis:\n    image: redis\n    links:\n      - web\n    networks:\n      - back-tier\n\n  lb:\n    image: dockercloud/haproxy\n    ports:\n      - 80:80\n    links:\n      - web\n    networks:\n      - front-tier\n      - back-tier\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock \n\nnetworks:\n  front-tier:\n    driver: bridge\n  back-tier:\n    driver: bridge\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br")])]),e("p",[s._v("Compose 目前有三个版本分别为 Version 1，Version 2，Version 3，Compose 区分 Version 1 和 Version 2（Compose 1.6.0+，Docker Engine 1.10.0+）。Version 2 支持更多的指令。Version 1 将来会被弃用。")]),s._v(" "),e("h3",{attrs:{id:"_2-image"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-image"}},[s._v("#")]),s._v(" 2. image")]),s._v(" "),e("p",[s._v("image 是指定服务的镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会尝试拉取镜像。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("services: \n    web: \n        image: hello-world\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_3-build"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-build"}},[s._v("#")]),s._v(" 3. build")]),s._v(" "),e("p",[s._v("服务除了可以基于指定的镜像，还可以基于一份 Dockerfile，在使用 up 启动时执行构建任务，构建标签是 build，可以指定 Dockerfile 所在文件夹的路径。Compose 将会利用 Dockerfile 自动构建镜像，然后使用镜像启动服务容器。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("build: /path/to/build/dir\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("也可以是相对路径，只要上下文确定就可以读取到 Dockerfile。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("build: ./dir\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("设定上下文根目录，然后以该目录为准指定 Dockerfile。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("build:\n  context: ../../\n  dockerfile: path/of/Dockerfile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("build 都是一个目录，如果要指定 Dockerfile 文件需要在 build 标签的子级标签中使用 dockerfile 标签指定。 如果同时指定 image 和 build 两个标签，那么 Compose 会构建镜像并且把镜像命名为 image 值指定的名字。")]),s._v(" "),e("h3",{attrs:{id:"_4-context"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-context"}},[s._v("#")]),s._v(" 4. context")]),s._v(" "),e("p",[s._v("context 选项可以是 Dockerfile 的文件路径，也可以是到链接到 git 仓库的 url，当提供的值是相对路径时，被解析为相对于撰写文件的路径，此目录也是发送到 Docker 守护进程的 context")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("build:\n  context: ./dir\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_5-dockerfile"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-dockerfile"}},[s._v("#")]),s._v(" 5. dockerfile")]),s._v(" "),e("p",[s._v("使用 dockerfile 文件来构建，必须指定构建路径")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("build:\n  context: .\n  dockerfile: Dockerfile-alternate\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_6-commond"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-commond"}},[s._v("#")]),s._v(" 6. commond")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("command: bundle exec thin -p 3000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_7-container-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-container-name"}},[s._v("#")]),s._v(" 7. container_name")]),s._v(" "),e("p",[s._v("Compose 的容器名称格式是：<项目名称>< 服务名称 >< 序号 >"),e("br"),s._v("\n可以自定义项目名称、服务名称，但如果想完全控制容器的命名，可以使用标签指定：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("container_name: app\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_8-depends-on"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-depends-on"}},[s._v("#")]),s._v(" 8. depends_on")]),s._v(" "),e("p",[s._v("在使用 Compose 时，最大的好处就是少打启动命令，但一般项目容器启动的顺序是有要求的，如果直接从上到下启动容器，必然会因为容器依赖问题而启动失败。例如在没启动数据库容器的时候启动应用容器，应用容器会因为找不到数据库而退出。depends_on 标签用于解决容器的依赖、启动先后的问题")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '2'\nservices:\n  web:\n    build: .\n    depends_on:\n      - db\n      - redis\n  redis:\n    image: redis\n  db:\n    image: postgres\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("上述 YAML 文件定义的容器会先启动 redis 和 db 两个服务，最后才启动 web 服务。")]),s._v(" "),e("h3",{attrs:{id:"_9-pid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-pid"}},[s._v("#")]),s._v(" 9. PID")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('pid: "host"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("将 PID 模式设置为主机 PID 模式，跟主机系统共享进程命名空间。容器使用 pid 标签将能够访问和操纵其他容器和宿主机的名称空间。")]),s._v(" "),e("h3",{attrs:{id:"_10-ports"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-ports"}},[s._v("#")]),s._v(" 10. ports")]),s._v(" "),e("p",[s._v("ports 用于映射端口的标签。　"),e("br"),s._v("\n使用 HOST:CONTAINER 格式或者只是指定容器的端口，宿主机会随机映射端口。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ports:\n - "3000"\n - "8000:8000"\n - "49100:22"\n - "127.0.0.1:8001:8001"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("当使用 HOST:CONTAINER 格式来映射端口时，如果使用的容器端口小于 60 可能会得到错误得结果，因为 YAML 将会解析 xx:yy 这种数字格式为 60 进制。所以建议采用字符串格式。")]),s._v(" "),e("h3",{attrs:{id:"_11-extra-hosts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-extra-hosts"}},[s._v("#")]),s._v(" 11. extra_hosts")]),s._v(" "),e("p",[s._v("添加主机名的标签，会在 / etc/hosts 文件中添加一些记录。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('extra_hosts:\n - "somehost:162.242.195.82"\n - "otherhost:50.31.209.229"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("启动后查看容器内部 hosts：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("162.242.195.82  somehost\n50.31.209.229   otherhost\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_12-volumes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_12-volumes"}},[s._v("#")]),s._v(" 12. volumes")]),s._v(" "),e("p",[s._v("挂载一个目录或者一个已存在的数据卷容器，可以直接使用 [HOST:CONTAINER]格式，或者使用 [HOST:CONTAINER:ro] 格式，后者对于容器来说，数据卷是只读的，可以有效保护宿主机的文件系统。 Compose 的数据卷指定路径可以是相对路径，使用 . 或者 .. 来指定相对目录。 数据卷的格式可以是下面多种形式")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("volumes:\n  // 只是指定一个路径，Docker 会自动在创建一个数据卷（这个路径是容器内部的）。\n  - /var/lib/mysql\n  // 使用绝对路径挂载数据卷\n  - /opt/data:/var/lib/mysql\n  // 以 Compose 配置文件为中心的相对路径作为数据卷挂载到容器。\n  - ./cache:/tmp/cache\n  // 使用用户的相对路径（~/ 表示的目录是 /home/<用户目录>/ 或者 /root/）。\n  - ~/configs:/etc/configs/:ro\n  // 已经存在的命名的数据卷。\n  - datavolume:/var/lib/mysql\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("如果不使用宿主机的路径，可以指定一个 volume_driver。")]),s._v(" "),e("h3",{attrs:{id:"_13-volumes-from"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_13-volumes-from"}},[s._v("#")]),s._v(" 13. volumes_from")]),s._v(" "),e("p",[s._v("从另一个服务或容器挂载其数据卷：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("volumes_from:\n   - service_name    \n     - container_name\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_14-dns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_14-dns"}},[s._v("#")]),s._v(" 14. dns")]),s._v(" "),e("p",[s._v("自定义 DNS 服务器。可以是一个值，也可以是一个列表。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("dns：8.8.8.8\ndns：\n    - 8.8.8.8    \n      - 9.9.9.9\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_15-expose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_15-expose"}},[s._v("#")]),s._v(" 15. expose")]),s._v(" "),e("p",[s._v("暴露端口，但不映射到宿主机，只允许能被连接的服务访问。仅可以指定内部端口为参数，如下所示：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('expose:\n    - "3000"\n    - "8000"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_16-links"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_16-links"}},[s._v("#")]),s._v(" 16.links")]),s._v(" "),e("p",[s._v("链接到其它服务中的容器。使用服务名称（同时作为别名），或者服务名称: 服务别名（如 SERVICE:ALIAS），例如")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("links:\n    - db\n    - db:database\n    - redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_17-net"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_17-net"}},[s._v("#")]),s._v(" 17.net")]),s._v(" "),e("p",[s._v("设置网络模式。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('net: "bridge"\nnet: "none"\nnet: "host"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"四-docker-compose-模板文件示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四-docker-compose-模板文件示例"}},[s._v("#")]),s._v(" 四. Docker-compose 模板文件示例")]),s._v(" "),e("h3",{attrs:{id:"_1-docker-compose-模板文件编写"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-compose-模板文件编写"}},[s._v("#")]),s._v(" 1. Docker-compose 模板文件编写")]),s._v(" "),e("hr"),s._v(" "),e("p",[e("code",[s._v("docker-compose.yml")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('version: \'2\'\nservices:\n  web1:\n    image: nginx\n    ports: \n      - "6061:80"\n    container_name: "web1"\n    networks:\n      - dev\n  web2:\n    image: nginx\n    ports: \n      - "6062:80"\n    container_name: "web2"\n    networks:\n      - dev\n      - pro\n  web3:\n    image: nginx\n    ports: \n      - "6063:80"\n    container_name: "web3"\n    networks:\n      - pro\nnetworks:\n  dev:\n    driver: bridge\n  pro:\n    driver: bridge\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("p",[s._v("docker-compose.yml 文件指定了 3 个 web 服务")]),s._v(" "),e("h3",{attrs:{id:"_2-启动应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动应用"}},[s._v("#")]),s._v(" 2. 启动应用")]),s._v(" "),e("p",[s._v("创建一个 webapp 目录，将 docker-compose.yaml 文件拷贝到 webapp 目录下，使用 docker-compose 启动应用。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_3-服务访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务访问"}},[s._v("#")]),s._v(" 3. 服务访问")]),s._v(" "),e("p",[s._v("通过浏览器访问 web1，web2，web3")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("http://127.0.0.1:6061\nhttp://127.0.0.1:6062\nhttp://127.0.0.1:6063\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);