(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{813:function(a,v,e){"use strict";e.r(v);var t=e(3),_=Object(t.a)({},(function(){var a=this,v=a._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[v("p",[a._v("当CPU写数据时，如果发现操作的变量是共享变量，即在其他CPU中也存在该变量的副本，会发出信号通知其他CPU将该变量的缓存行置为无效状态，因此当其他CPU需要读取这个变量时，发现自己缓存中缓存该变量的缓存行是无效的，那么它就会从内存重新读取。")]),a._v(" "),v("h1",{attrs:{id:"至于是怎么发现数据是否失效呢"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#至于是怎么发现数据是否失效呢"}},[a._v("#")]),a._v(" 至于是怎么发现数据是否失效呢？")]),a._v(" "),v("p",[v("strong",[a._v("嗅探")]),a._v(" 每个处理器通过"),v("strong",[a._v("嗅探在总线上传播的数据来检查自己缓存的值是不是过期了")]),a._v("，当处理器发现自己缓存行对应的内存地址被修改，就会将当前处理器的缓存行设置成无效状态，当处理器对这个数据进行修改操作的时候，会重新从系统内存中把数据读到处理器缓存里。")]),a._v(" "),v("h1",{attrs:{id:"原理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),v("p",[a._v("MESI 协议其实是 4 个状态单词的开头字⺟缩写，分别是：")]),a._v(" "),v("ul",[v("li",[a._v("Modified，已修改")]),a._v(" "),v("li",[a._v("Exclusive，独占")]),a._v(" "),v("li",[a._v("Shared，共享")]),a._v(" "),v("li",[a._v("Invalidated，已失效\n这四个状态来标记 Cache Line 四个不同的状态。")])]),a._v(" "),v("p",[a._v("「已修改」状态就是我们前⾯提到的脏标记，代表该 Cache Block 上的数据已经被更新过，但是还没有写到内存⾥。")]),a._v(" "),v("p",[a._v("「已失效」状态，表示的是这个 Cache Block ⾥的数据已经失效了，不可以读取该状态的数\n据。")]),a._v(" "),v("p",[a._v("「独占」和「共享」状态都代表 Cache Block ⾥的数据是⼲净的，也就是说，这个时候 Cache Block ⾥的数据和内存⾥⾯的数据是⼀致性的。")]),a._v(" "),v("p",[a._v("「独占」和「共享」的差别在于，独占状态的时候，数据只存储在⼀个 CPU 核⼼的 Cache ⾥，⽽其他CPU 核⼼的 Cache 没有该数据。这个时候，如果要向独占的 Cache 写数据，就可以直接⾃由地写⼊，⽽不需要通知其他 CPU 核⼼，因为只有你这有这个数据，就不存在缓存⼀致性的问题了，于是就可以随便操作该数据。")]),a._v(" "),v("p",[a._v("另外，在「独占」状态下的数据，如果有其他核⼼从内存读取了相同的数据到各⾃的 Cache ，那么这个时候，独占状态下的数据就会变成共享状态。")]),a._v(" "),v("p",[a._v("那么，「共享」状态代表着相同的数据在多个 CPU 核⼼的 Cache ⾥都有，所以当我们要更新 Cache ⾥⾯的数据的时候，不能直接修改，⽽是要先向所有的其他 CPU 核⼼⼴播⼀个请求，要求先把其他核⼼的Cache 中对应的 Cache Line 标记为「⽆效」状态，然后再更新当前 Cache ⾥⾯的数据。")]),a._v(" "),v("h2",{attrs:{id:"嗅探的缺点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#嗅探的缺点"}},[a._v("#")]),a._v(" 嗅探的缺点")]),a._v(" "),v("p",[a._v("总线风暴：由于Volatile的MESI缓存一致性协议，需要不断的从主内存嗅探和cas不断循环，无效交互会导致总线带宽达到峰值。")])])}),[],!1,null,null,null);v.default=_.exports}}]);